{"version":3,"file":"utils-ac0458cc.js","sources":["../src/-private/utils.ts"],"sourcesContent":["import type ContextRegistry from '../context-registry';\nimport {\n  dependencySatisfies,\n  importSync,\n  macroCondition,\n} from '@embroider/macros';\nimport { isDestroying, isDestroyed } from '@ember/destroyable';\nimport type Owner from '@ember/owner';\n\nlet getOwner: (context: unknown) => Owner | undefined;\n\nif (macroCondition(dependencySatisfies('ember-source', '>=4.10.0'))) {\n  getOwner = (importSync('@ember/owner') as any).getOwner;\n} else {\n  getOwner = (importSync('@ember/application') as any).getOwner;\n}\n\nexport function getProvider(\n  component: object,\n  contextKey: keyof ContextRegistry,\n) {\n  const appOwner = getOwner(component);\n\n  // We can't call .lookup on a destroyed owner\n  if (isDestroyed(appOwner as any) || isDestroying(appOwner as any)) {\n    return null;\n  }\n\n  const renderer = appOwner?.lookup('renderer:-dom') as any;\n\n  if (renderer == null) {\n    return null;\n  }\n\n  // In Ember 6 the path to env is renderer._context.env,\n  // before that it was renderer._runtime.env\n  const env = renderer._runtime?.env ?? renderer._context?.env;\n  const provideConsumeContextContainer = env?.provideConsumeContextContainer;\n\n  if (provideConsumeContextContainer == null) {\n    return null;\n  }\n\n  const contextsObject = provideConsumeContextContainer.contextsFor(component);\n  return contextsObject?.[contextKey];\n}\n\n/**\n * Checks whether a context with the given key exists for the provided component.\n *\n * @param {Object} component - The component to check for the context.\n * @param {string} contextKey - The key of the context to check for.\n */\nexport function hasContext(\n  component: object,\n  contextKey: keyof ContextRegistry,\n) {\n  const provider = getProvider(component, contextKey);\n  return provider != null;\n}\n\n/**\n * Returns the value of the context for the given key, if one exists.\n *\n * @param {Object} component - The component to check for the context.\n * @param {string} contextKey - The key of the context to check for.\n */\nexport function getContextValue<K extends keyof ContextRegistry>(\n  component: object,\n  contextKey: K,\n): ContextRegistry[K] | undefined {\n  if (!hasContext(component, contextKey)) {\n    return undefined;\n  }\n  const providerObj = getProvider(component, contextKey);\n  if (providerObj == null) {\n    return undefined;\n  }\n  return providerObj.instance[providerObj.key];\n}\n"],"names":["getOwner","macroCondition","dependencySatisfies","importSync","getProvider","component","contextKey","appOwner","isDestroyed","isDestroying","renderer","lookup","env","_runtime","_context","provideConsumeContextContainer","contextsObject","contextsFor","hasContext","provider","getContextValue","undefined","providerObj","instance","key"],"mappings":";;;AASA,IAAIA,QAAiD,CAAA;AAErD,IAAIC,cAAc,CAACC,mBAAmB,CAAC,cAAc,EAAE,UAAU,CAAC,CAAC,EAAE;AACnEF,EAAAA,QAAQ,GAAIG,UAAU,CAAC,cAAc,CAAC,CAASH,QAAQ,CAAA;AACzD,CAAC,MAAM;AACLA,EAAAA,QAAQ,GAAIG,UAAU,CAAC,oBAAoB,CAAC,CAASH,QAAQ,CAAA;AAC/D,CAAA;AAEO,SAASI,WAAWA,CACzBC,SAAiB,EACjBC,UAAiC,EACjC;AACA,EAAA,MAAMC,QAAQ,GAAGP,QAAQ,CAACK,SAAS,CAAC,CAAA;;AAEpC;EACA,IAAIG,WAAW,CAACD,QAAe,CAAC,IAAIE,YAAY,CAACF,QAAe,CAAC,EAAE;AACjE,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEA,EAAA,MAAMG,QAAQ,GAAGH,QAAQ,EAAEI,MAAM,CAAC,eAAe,CAAQ,CAAA;EAEzD,IAAID,QAAQ,IAAI,IAAI,EAAE;AACpB,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;;AAEA;AACA;AACA,EAAA,MAAME,GAAG,GAAGF,QAAQ,CAACG,QAAQ,EAAED,GAAG,IAAIF,QAAQ,CAACI,QAAQ,EAAEF,GAAG,CAAA;AAC5D,EAAA,MAAMG,8BAA8B,GAAGH,GAAG,EAAEG,8BAA8B,CAAA;EAE1E,IAAIA,8BAA8B,IAAI,IAAI,EAAE;AAC1C,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEA,EAAA,MAAMC,cAAc,GAAGD,8BAA8B,CAACE,WAAW,CAACZ,SAAS,CAAC,CAAA;EAC5E,OAAOW,cAAc,GAAGV,UAAU,CAAC,CAAA;AACrC,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACO,SAASY,UAAUA,CACxBb,SAAiB,EACjBC,UAAiC,EACjC;AACA,EAAA,MAAMa,QAAQ,GAAGf,WAAW,CAACC,SAAS,EAAEC,UAAU,CAAC,CAAA;EACnD,OAAOa,QAAQ,IAAI,IAAI,CAAA;AACzB,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,eAAeA,CAC7Bf,SAAiB,EACjBC,UAAa,EACmB;AAChC,EAAA,IAAI,CAACY,UAAU,CAACb,SAAS,EAAEC,UAAU,CAAC,EAAE;AACtC,IAAA,OAAOe,SAAS,CAAA;AAClB,GAAA;AACA,EAAA,MAAMC,WAAW,GAAGlB,WAAW,CAACC,SAAS,EAAEC,UAAU,CAAC,CAAA;EACtD,IAAIgB,WAAW,IAAI,IAAI,EAAE;AACvB,IAAA,OAAOD,SAAS,CAAA;AAClB,GAAA;AACA,EAAA,OAAOC,WAAW,CAACC,QAAQ,CAACD,WAAW,CAACE,GAAG,CAAC,CAAA;AAC9C;;;;"}